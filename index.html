<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ –ú–æ–π –ö–∞–±–∏–Ω–µ—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #2481cc;
            --secondary: #2ea043;
            --danger: #e74c3c;
            --bg: #f8f9fa;
            --card: #ffffff;
            --text: #333333;
            --border: #e0e0e0;
        }
        
        body.dark {
            --bg: #1a1a1a;
            --card: #2d2d2d;
            --text: #ffffff;
            --border: #444444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 80px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
        }
        
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }
        
        .balance-card {
            background: linear-gradient(135deg, var(--primary), #6c5ce7);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(37, 129, 204, 0.3);
        }
        
        .balance-label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .balance-amount {
            font-size: 52px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .menu-item {
            background: var(--card);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            text-decoration: none;
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--border);
            transition: transform 0.2s;
        }
        
        .menu-item:active {
            transform: scale(0.98);
        }
        
        .menu-item i {
            font-size: 28px;
            color: var(--primary);
        }
        
        .referral-section {
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            margin-top: 25px;
            border: 1px solid var(--border);
        }
        
        .referral-code {
            background: var(--bg);
            padding: 20px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 22px;
            text-align: center;
            margin: 20px 0;
            letter-spacing: 3px;
            border: 2px dashed var(--primary);
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s;
        }
        
        .btn:active {
            transform: translateY(2px);
        }
        
        .btn-copy {
            background: var(--secondary);
        }
        
        .btn-share {
            background: linear-gradient(135deg, #0088cc, #00acee);
        }
        
        .loader {
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .admin-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: #ef4444;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            font-size: 24px;
            z-index: 1000;
        }
        
        @media (max-width: 480px) {
            .balance-amount {
                font-size: 44px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            
            .stat-value {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="avatar" id="user-avatar">
                üë§
            </div>
            <h2 id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
            <p style="color: #666; margin-top: 5px;">ID: <span id="user-id">...</span></p>
        </div>
        
        <div class="balance-card">
            <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
            <div class="balance-amount" id="balance">0 ‚ÇΩ</div>
            <div style="opacity: 0.9; margin-top: 10px; font-size: 14px;">
                +10% –æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ 1-–≥–æ —É—Ä–æ–≤–Ω—è<br>
                +5% –æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ 2-–≥–æ —É—Ä–æ–≤–Ω—è
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="ref-count-1">0</div>
                <div style="color: #666; font-size: 14px;">1-–π —É—Ä–æ–≤–µ–Ω—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="ref-count-2">0</div>
                <div style="color: #666; font-size: 14px;">2-–π —É—Ä–æ–≤–µ–Ω—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="ref-earnings">0</div>
                <div style="color: #666; font-size: 14px;">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
            </div>
        </div>
        
        <div class="menu-grid">
            <a href="#" class="menu-item" onclick="showHistory()">
                <span style="font-size: 30px;">üìä</span>
                <span>–ò—Å—Ç–æ—Ä–∏—è</span>
            </a>
            <a href="#" class="menu-item" onclick="showWithdraw()">
                <span style="font-size: 30px;">üí∞</span>
                <span>–í—ã–≤–æ–¥</span>
            </a>
            <a href="#" class="menu-item" onclick="showReferrals()">
                <span style="font-size: 30px;">üë•</span>
                <span>–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
            </a>
            <a href="#" class="menu-item" onclick="showSettings()">
                <span style="font-size: 30px;">‚öôÔ∏è</span>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </a>
        </div>
        
        <div class="referral-section">
            <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <span>üì¢</span>
                <span>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</span>
            </h3>
            
            <p style="margin-bottom: 20px; color: #666;">
                –ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 10% —Å –∏—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π (1-–π —É—Ä–æ–≤–µ–Ω—å) 
                –∏ 5% —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ 2-–≥–æ —É—Ä–æ–≤–Ω—è!
            </p>
            
            <div class="referral-code" id="ref-code">REF123456</div>
            
            <button class="btn btn-copy" onclick="copyRefCode()">
                <span>üìã</span>
                <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</span>
            </button>
            
            <button class="btn btn-share" onclick="shareRefLink()">
                <span>üì§</span>
                <span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram</span>
            </button>
            
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border);">
                <p style="font-weight: bold; margin-bottom: 10px;">üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:</p>
                <ol style="padding-left: 20px; color: #666;">
                    <li style="margin-bottom: 8px;">–î—Ä—É–≥ –≤–≤–æ–¥–∏—Ç –≤–∞—à –∫–æ–¥ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</li>
                    <li style="margin-bottom: 8px;">–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 10% —Å –∫–∞–∂–¥–æ–≥–æ –µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</li>
                    <li>–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 5% —Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –≤–∞—à–µ–≥–æ –¥—Ä—É–≥–∞</li>
                </ol>
            </div>
        </div>
        
        <div id="loader" class="loader hidden"></div>
    </div>
    
    <script>
        // –ì–û–¢–û–í–´–ô –ë–≠–ö–ï–ù–î (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!)
        const BACKEND_URL = 'https://fncvwotggxekubbasrjx.supabase.co/functions/v1/telegram-mini-app';
        const ADMIN_ID = 7156971224;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let userData = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            showLoader(true);
            
            try {
                const user = tg.initDataUnsafe.user;
                
                if (!user) {
                    tg.showAlert('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Telegram');
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const response = await fetch(BACKEND_URL + '/user', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ userId: user.id })
                });
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
                }
                
                const data = await response.json();
                userData = data;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateUserInfo(user);
                updateBalance(data.user.balance);
                updateReferralStats(data.stats);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –∞–¥–º–∏–Ω
                if (user.id === ADMIN_ID) {
                    showAdminButton();
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                tg.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                showTestData();
            } finally {
                showLoader(false);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserInfo(tgUser) {
            document.getElementById('user-name').textContent = 
                tgUser.first_name + (tgUser.last_name ? ' ' + tgUser.last_name : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
            
            document.getElementById('user-id').textContent = tgUser.id;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä
            const avatar = document.getElementById('user-avatar');
            if (tgUser.first_name) {
                avatar.textContent = tgUser.first_name.charAt(0).toUpperCase();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function updateBalance(balance) {
            document.getElementById('balance').textContent = 
                new Intl.NumberFormat('ru-RU').format(balance) + ' ‚ÇΩ';
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateReferralStats(stats) {
            if (!stats) return;
            
            document.getElementById('ref-count-1').textContent = stats.level1 || 0;
            document.getElementById('ref-count-2').textContent = stats.level2 || 0;
            document.getElementById('ref-earnings').textContent = (stats.earnings || 0) + ' ‚ÇΩ';
            
            if (userData && userData.user) {
                document.getElementById('ref-code').textContent = userData.user.referralCode;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ç–∏)
        function showTestData() {
            document.getElementById('user-name').textContent = '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            document.getElementById('user-id').textContent = '123456789';
            document.getElementById('balance').textContent = '1 500 ‚ÇΩ';
            document.getElementById('ref-count-1').textContent = '3';
            document.getElementById('ref-count-2').textContent = '12';
            document.getElementById('ref-earnings').textContent = '450 ‚ÇΩ';
            document.getElementById('ref-code').textContent = 'REF789012';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞
            showAdminButton();
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
        async function copyRefCode() {
            const code = document.getElementById('ref-code').textContent;
            
            try {
                await navigator.clipboard.writeText(code);
                tg.showAlert('‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            } catch (err) {
                tg.showAlert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥');
            }
        }
        
        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π
        function shareRefLink() {
            const code = document.getElementById('ref-code').textContent;
            const text = `üí∞ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ!\n\n–ú–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥: ${code}\n\n–ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å!`;
            
            const url = `https://t.me/share/url?url=https://t.me&text=${encodeURIComponent(text)}`;
            tg.openTelegramLink(url);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é
        function showHistory() {
            tg.showAlert('üìä –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π\n\n–§—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!');
        }
        
        function showWithdraw() {
            tg.showAlert('üí∞ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤\n\n–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞: 500 ‚ÇΩ\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã:\n‚Ä¢ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞\n‚Ä¢ –ÆMoney\n‚Ä¢ Qiwi');
        }
        
        function showReferrals() {
            tg.showAlert('üë• –°–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤\n\n–§—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!');
        }
        
        function showSettings() {
            tg.showAlert('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏\n\n‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n‚Ä¢ –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n\n–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫!');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫
        function showLoader(show) {
            document.getElementById('loader').classList.toggle('hidden', !show);
        }
        
        // –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞
        function showAdminButton() {
            const existingBtn = document.querySelector('.admin-btn');
            if (existingBtn) return;
            
            const adminBtn = document.createElement('a');
            adminBtn.href = 'admin.html';
            adminBtn.className = 'admin-btn';
            adminBtn.innerHTML = 'üîê';
            adminBtn.title = '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å';
            document.body.appendChild(adminBtn);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initApp);
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        window.copyRefCode = copyRefCode;
        window.shareRefLink = shareRefLink;
        window.showHistory = showHistory;
        window.showWithdraw = showWithdraw;
        window.showReferrals = showReferrals;
        window.showSettings = showSettings;
    </script>
</body>
</html>
